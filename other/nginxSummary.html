<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>nginx小记 | huskyAreYouScared-Blog</title>
    <meta name="description" content="持续学习者，憧憬未来的开发者">
    <link rel="icon" href="./favicon.ico">
  <link rel="manifest" href="./manifest.json">
    
    <link rel="preload" href="/blog/assets/css/0.styles.70904243.css" as="style"><link rel="preload" href="/blog/assets/js/app.d2fbee4d.js" as="script"><link rel="preload" href="/blog/assets/js/2.f0d7d4dd.js" as="script"><link rel="preload" href="/blog/assets/js/45.d704c988.js" as="script"><link rel="preload" href="/blog/assets/js/5.c71d2297.js" as="script"><link rel="preload" href="/blog/assets/js/3.1faefed4.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.11cf69db.js"><link rel="prefetch" href="/blog/assets/js/11.d6a96ff0.js"><link rel="prefetch" href="/blog/assets/js/12.d5eee066.js"><link rel="prefetch" href="/blog/assets/js/13.7e9aebaa.js"><link rel="prefetch" href="/blog/assets/js/14.cb0c9160.js"><link rel="prefetch" href="/blog/assets/js/15.c85b5a0f.js"><link rel="prefetch" href="/blog/assets/js/16.87648487.js"><link rel="prefetch" href="/blog/assets/js/17.93ec2e66.js"><link rel="prefetch" href="/blog/assets/js/18.caf41a32.js"><link rel="prefetch" href="/blog/assets/js/19.f41f9428.js"><link rel="prefetch" href="/blog/assets/js/20.bf540747.js"><link rel="prefetch" href="/blog/assets/js/21.9e4f7d80.js"><link rel="prefetch" href="/blog/assets/js/22.b04bcb86.js"><link rel="prefetch" href="/blog/assets/js/23.8e1294a2.js"><link rel="prefetch" href="/blog/assets/js/24.df20811a.js"><link rel="prefetch" href="/blog/assets/js/25.c267a93f.js"><link rel="prefetch" href="/blog/assets/js/26.c9f93c32.js"><link rel="prefetch" href="/blog/assets/js/27.af1ff22d.js"><link rel="prefetch" href="/blog/assets/js/28.62d2fb41.js"><link rel="prefetch" href="/blog/assets/js/29.0290f701.js"><link rel="prefetch" href="/blog/assets/js/30.346dbf54.js"><link rel="prefetch" href="/blog/assets/js/31.bf30805b.js"><link rel="prefetch" href="/blog/assets/js/32.65ed3470.js"><link rel="prefetch" href="/blog/assets/js/33.88bf3064.js"><link rel="prefetch" href="/blog/assets/js/34.90461ad4.js"><link rel="prefetch" href="/blog/assets/js/35.226c57cd.js"><link rel="prefetch" href="/blog/assets/js/36.9a6968ae.js"><link rel="prefetch" href="/blog/assets/js/37.30cab2d5.js"><link rel="prefetch" href="/blog/assets/js/38.a23a19e2.js"><link rel="prefetch" href="/blog/assets/js/39.b9ded95c.js"><link rel="prefetch" href="/blog/assets/js/4.61e29306.js"><link rel="prefetch" href="/blog/assets/js/40.de056cfb.js"><link rel="prefetch" href="/blog/assets/js/41.73b72f7a.js"><link rel="prefetch" href="/blog/assets/js/42.16fa923c.js"><link rel="prefetch" href="/blog/assets/js/43.2d7c6bb2.js"><link rel="prefetch" href="/blog/assets/js/44.40b8e2ab.js"><link rel="prefetch" href="/blog/assets/js/46.aa91f39f.js"><link rel="prefetch" href="/blog/assets/js/47.6339d775.js"><link rel="prefetch" href="/blog/assets/js/48.c1d32851.js"><link rel="prefetch" href="/blog/assets/js/49.c4a5de44.js"><link rel="prefetch" href="/blog/assets/js/50.56d132eb.js"><link rel="prefetch" href="/blog/assets/js/51.5be91cf9.js"><link rel="prefetch" href="/blog/assets/js/52.46ea5f3a.js"><link rel="prefetch" href="/blog/assets/js/53.f380b6e6.js"><link rel="prefetch" href="/blog/assets/js/54.62940591.js"><link rel="prefetch" href="/blog/assets/js/55.f2570849.js"><link rel="prefetch" href="/blog/assets/js/56.5f6132ba.js"><link rel="prefetch" href="/blog/assets/js/57.e7bc2575.js"><link rel="prefetch" href="/blog/assets/js/58.39b6f70e.js"><link rel="prefetch" href="/blog/assets/js/59.7ab4979a.js"><link rel="prefetch" href="/blog/assets/js/6.d7ede57b.js"><link rel="prefetch" href="/blog/assets/js/60.f4671fb6.js"><link rel="prefetch" href="/blog/assets/js/61.3f29614c.js"><link rel="prefetch" href="/blog/assets/js/62.e7b58af3.js"><link rel="prefetch" href="/blog/assets/js/63.183f5010.js"><link rel="prefetch" href="/blog/assets/js/64.a0534cb6.js"><link rel="prefetch" href="/blog/assets/js/65.d0fffd27.js"><link rel="prefetch" href="/blog/assets/js/66.da99eca6.js"><link rel="prefetch" href="/blog/assets/js/67.dcd2a260.js"><link rel="prefetch" href="/blog/assets/js/68.4a298099.js"><link rel="prefetch" href="/blog/assets/js/69.d363c4ae.js"><link rel="prefetch" href="/blog/assets/js/7.7d3815a0.js"><link rel="prefetch" href="/blog/assets/js/70.5c86c8be.js"><link rel="prefetch" href="/blog/assets/js/71.c26cfb56.js"><link rel="prefetch" href="/blog/assets/js/72.c9732478.js"><link rel="prefetch" href="/blog/assets/js/8.d0154a95.js"><link rel="prefetch" href="/blog/assets/js/9.c2f3e98f.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.70904243.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><img src="/blog/logo/logo.gif" alt="huskyAreYouScared-Blog" class="logo"> <span class="site-name can-hide">huskyAreYouScared-Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/subtitle/" class="nav-link">husky字幕</a></div><div class="nav-item"><a href="/blog/HtmlAndCss/" class="nav-link">前端日志</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/blog/source/" class="nav-link">资源</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link router-link-active">技术杂谈</a></div><div class="nav-item"><a href="https://github.com/huskyAreYouScared/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://husky_are_you_scared.gitee.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">主页</a></div><div class="nav-item"><a href="/blog/subtitle/" class="nav-link">husky字幕</a></div><div class="nav-item"><a href="/blog/HtmlAndCss/" class="nav-link">前端日志</a></div><div class="nav-item"><a href="/blog/algorithm/" class="nav-link">算法</a></div><div class="nav-item"><a href="/blog/source/" class="nav-link">资源</a></div><div class="nav-item"><a href="/blog/other/" class="nav-link router-link-active">技术杂谈</a></div><div class="nav-item"><a href="https://github.com/huskyAreYouScared/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://husky_are_you_scared.gitee.io/blog/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  国内地址
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/other/vuepress_build.html" class="sidebar-link">github action使用体验</a></li><li><a href="/blog/other/mac_terminal.html" class="sidebar-link">mac隐藏终端用户名</a></li><li><a href="/blog/other/mac_npm_error.html" class="sidebar-link">解决mac权限问题报错</a></li><li><a href="/blog/other/auto_watch_video.html" class="sidebar-link">Auto.js自动刷短视频</a></li><li><a href="/blog/other/conventional_changelog.html" class="sidebar-link">自动更新日志</a></li><li><a href="/blog/other/steam_community.html" class="sidebar-link">steam社区访问</a></li><li><a href="/blog/other/nginxSummary.html" class="active sidebar-link">nginx小记</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#install-nginx" class="sidebar-link">install nginx</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#nginx的常用命令" class="sidebar-link">nginx的常用命令</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#运行第一个静态网站" class="sidebar-link">运行第一个静态网站</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#gzip压缩开启" class="sidebar-link">gzip压缩开启</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#权限" class="sidebar-link">权限</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#location匹配" class="sidebar-link">location匹配</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#设置虚拟主机" class="sidebar-link">设置虚拟主机</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#反向代理" class="sidebar-link">反向代理</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#适配pc或mobile设备，来跳转不同域名" class="sidebar-link">适配PC或mobile设备，来跳转不同域名</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#负载均衡" class="sidebar-link">负载均衡</a></li><li class="sidebar-sub-header"><a href="/blog/other/nginxSummary.html#相关" class="sidebar-link">相关</a></li></ul></li><li><a href="/blog/other/dockerSummary.html" class="sidebar-link">docker小记</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="nginx小记"><a href="#nginx小记" class="header-anchor">#</a> nginx小记</h1> <ul><li>本次学习nginx使用的是Ubuntu系统</li></ul> <h2 id="install-nginx"><a href="#install-nginx" class="header-anchor">#</a> install nginx</h2> <ul><li>nginx下载地址<a href="http://nginx.org/en/download.html" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="nginx的常用命令"><a href="#nginx的常用命令" class="header-anchor">#</a> nginx的常用命令</h2> <h3 id="启动命令"><a href="#启动命令" class="header-anchor">#</a> 启动命令</h3> <ul><li>直接输入nginx</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>还可以通过systemctl来开启</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>systemctl start nginx.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="停止nginx"><a href="#停止nginx" class="header-anchor">#</a> 停止nginx</h3> <h4 id="立即停止"><a href="#立即停止" class="header-anchor">#</a> 立即停止</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>nginx -s stop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="优雅的停止"><a href="#优雅的停止" class="header-anchor">#</a> 优雅的停止</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>nginx -s quit
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="kill-结束nginx进程"><a href="#kill-结束nginx进程" class="header-anchor">#</a> kill 结束nginx进程</h4> <ul><li>先查看nginx占用的PID</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>  <span class="token function">lsof</span> -i:80
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>输出如下内容，找到nginx进程的PID</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>COMMAND     PID     <span class="token environment constant">USER</span>   FD   TYPE    DEVICE SIZE/OFF NODE NAME
nginx     <span class="token number">16903</span>     root    6u  IPv4 <span class="token number">645602965</span>      0t0  TCP *:http <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span>
nginx     <span class="token number">16903</span>     root    7u  IPv6 <span class="token number">645602966</span>      0t0  TCP *:http <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span>
nginx     <span class="token number">16904</span> www-data    6u  IPv4 <span class="token number">645602965</span>      0t0  TCP *:http <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span>
nginx     <span class="token number">16904</span> www-data    7u  IPv6 <span class="token number">645602966</span>      0t0  TCP *:http <span class="token punctuation">(</span>LISTEN<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>使用kill命令结束进程</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">kill</span> -9 <span class="token number">16903</span> <span class="token operator">&amp;&amp;</span> <span class="token function">kill</span> -9 <span class="token number">16904</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>也可以使用 killall 命令结束nginx进程</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">killall</span> nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="运行第一个静态网站"><a href="#运行第一个静态网站" class="header-anchor">#</a> 运行第一个静态网站</h2> <h3 id="配置文件介绍"><a href="#配置文件介绍" class="header-anchor">#</a> 配置文件介绍</h3> <ul><li>主配置文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/etc/nginx/nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>子配置项，一般我们没有做任何的定制，子配置项会在</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>/etc/nginx/conf.d/default/*.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="配置编写"><a href="#配置编写" class="header-anchor">#</a> 配置编写</h3> <ul><li>首先准备好静态页面，这里我用的是我自己开发的<a href="https://github.com/huskyAreYouScared/crazy-future" target="_blank" rel="noopener noreferrer">粒子动画展示网站-cfazy-future<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li> <li>将打包好的文件发送到服务器的 <code>/data/blog/dist</code>目录下</li> <li>修改<code>nginx</code>的配置，在<code>/etc/nginx/conf.d/default.conf</code>中写入一下配置</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
      listen <span class="token number">80</span><span class="token punctuation">;</span>
      server_name www.woniuwnwn.top<span class="token punctuation">;</span>
      location / <span class="token punctuation">{</span>
              root /data/blog/dist<span class="token punctuation">;</span>
              index index.html index.htm<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>退出保存重启<code>nginx -s reload</code>，如果之前没有启动，直接<code>nginx</code>启动即可</li> <li>点击图片预览
<a href="http://www.woniuwnwn.top/" target="_blank" rel="noopener noreferrer"><img src="https://imgkr.cn-bj.ufileos.com/5ca4f1d8-bf37-47fa-bcb6-44565a9cdaf9.png" alt="预览"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>需要注意的是 server_name 要写对域名，否则直接输入域名访问不了，还需要再域名后面配上 /index.html</li> <li>eg: http://www.woniuwnwn.top/index.html</li> <li>version : nginx version: nginx/1.14.0 (Ubuntu)</li></ul></div> <h3 id="指定错误页面"><a href="#指定错误页面" class="header-anchor">#</a> 指定错误页面</h3> <ul><li>通过<code>error_page</code>来指定</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
      listen <span class="token number">80</span><span class="token punctuation">;</span>
      server_name www.woniuwnwn.top<span class="token punctuation">;</span>
      error_page /xx/xx/404.html
      location / <span class="token punctuation">{</span>
              root /data/blog/dist<span class="token punctuation">;</span>
              index index.html index.htm<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>error_page后面也可以指定网址，如果资源未找到，直接跳转网址</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
      listen <span class="token number">80</span><span class="token punctuation">;</span>
      server_name www.woniuwnwn.top<span class="token punctuation">;</span>
      error_page www.woniuwnwn.top/error<span class="token punctuation">;</span>
      location / <span class="token punctuation">{</span>
              root /data/blog/dist<span class="token punctuation">;</span>
              index index.html index.htm<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h2 id="gzip压缩开启"><a href="#gzip压缩开启" class="header-anchor">#</a> gzip压缩开启</h2> <ul><li>首先进入nginx的主配置文件</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/nginx <span class="token operator">&amp;&amp;</span> <span class="token function">vim</span> nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>在http配置中增加gzip的属性并开启</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>http<span class="token punctuation">{</span>
  <span class="token function">gzip</span> on<span class="token punctuation">;</span>

  <span class="token comment"># other config</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>gzip有很多配置参数<a href="http://nginx.org/en/docs/http/ngx_http_gzip_module.html" target="_blank" rel="noopener noreferrer">官网传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="权限"><a href="#权限" class="header-anchor">#</a> 权限</h2> <h3 id="deny和allow"><a href="#deny和allow" class="header-anchor">#</a> deny和allow</h3> <ul><li>通过deny和allow配置拒绝和可访问的ip</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
      listen <span class="token number">80</span><span class="token punctuation">;</span>
      server_name www.woniuwnwn.top<span class="token punctuation">;</span>
      location / <span class="token punctuation">{</span>
              root /data/blog/dist<span class="token punctuation">;</span>
              index index.html index.htm<span class="token punctuation">;</span>
              deny xx.xx.xx.xx/xx<span class="token punctuation">;</span>
              allow xx.xx.xx.xx/xx<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li>denu 和 allow 后面的 xx/xx代表一段连续的ip拒绝和允许访问</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>location / {
        root /data/blog/dist;
        index index.html index.htm;
        deny 192.168.1.5/100; # 表示拒绝从5~100的IP访问
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="deny和allow的优先级"><a href="#deny和allow的优先级" class="header-anchor">#</a> deny和allow的优先级</h3> <ul><li>写在上面的优先级要高，所以说下面这个例子是，允许192.168.1.5/100这些ip访问的，deny无效</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>location / {
        root /data/blog/dist;
        index index.html index.htm;
        allow 192.168.1.5/100; # 表示允许从5~100的IP访问
        deny 192.168.1.5/100; # 表示拒绝从5~100的IP访问
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="location匹配"><a href="#location匹配" class="header-anchor">#</a> location匹配</h2> <h3 id="精确匹配-“-”"><a href="#精确匹配-“-”" class="header-anchor">#</a> 精确匹配 “=”</h3> <ul><li><code>=</code> 匹配的优先级最高</li> <li>不允许用户访问后台管理</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location <span class="token operator">=</span>/back-stage <span class="token punctuation">{</span>
        root /data/blog/dist<span class="token punctuation">;</span>
        index index.html index.htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="精确匹配-“-”-2"><a href="#精确匹配-“-”-2" class="header-anchor">#</a> 精确匹配 “^~”</h3> <ul><li><code>^~</code> 匹配的优先级次于<code>=</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location ^~/back-stage <span class="token punctuation">{</span>
        root /data/blog/dist<span class="token punctuation">;</span>
        index index.html index.htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="正则匹配-“-”"><a href="#正则匹配-“-”" class="header-anchor">#</a> 正则匹配 “~”</h3> <ul><li><code>~</code> 匹配的优先级次于<code>^~</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location ~<span class="token punctuation">\</span>.mov$ <span class="token punctuation">{</span>
        root /data/blog/dist<span class="token punctuation">;</span>
        index index.html index.htm<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h3 id="匹配任何查询"><a href="#匹配任何查询" class="header-anchor">#</a> 匹配任何查询</h3> <ul><li>优先级最低</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>location / <span class="token punctuation">{</span>
        root /data/blog/dist<span class="token punctuation">;</span>
        index index.html index.htm<span class="token punctuation">;</span>
        allow all<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h2 id="设置虚拟主机"><a href="#设置虚拟主机" class="header-anchor">#</a> 设置虚拟主机</h2> <h3 id="通过域名设置虚拟主机"><a href="#通过域名设置虚拟主机" class="header-anchor">#</a> 通过域名设置虚拟主机</h3> <ul><li>需要在准备一个域名，我们可以在解析一个子域名 我这里新解析了一个<code>test.woniuwnwn.top</code>域名</li> <li>在准备一个静态页面</li></ul> <div class="language- line-numbers-mode"><pre class="language-text"><code>cd /data/test &amp;&amp; mkdir index.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language- line-numbers-mode"><pre class="language-text"><code>echo '&lt;h1&gt;test&lt;/h1&gt;' &gt;&gt; index.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>在上面的例子中已经在<code>conf.d</code>目录下有一个<code>default.conf</code>子配置项，这里我们要新建一个</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> /etc/nginx/conf.d <span class="token operator">&amp;&amp;</span> <span class="token function">vim</span> test.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>新建好文件之后在里面在配一套<code>server</code></li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
      listen <span class="token number">80</span><span class="token punctuation">;</span>
      server_name test.woniuwnwn.top<span class="token punctuation">;</span>
      location / <span class="token punctuation">{</span>
              root /data/test<span class="token punctuation">;</span>
              index index.html index.htm<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><ul><li>此时在重启nginx就可以通过test.woniuwnwn.top访问我们配置的虚拟主机的项目了</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>nginx -s reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="反向代理"><a href="#反向代理" class="header-anchor">#</a> 反向代理</h2> <ul><li>正向代理是给客户端做代理</li> <li>反向代理是给服务器做代理</li></ul> <h3 id="proxy-pass-反向代理"><a href="#proxy-pass-反向代理" class="header-anchor">#</a> proxy_pass 反向代理</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name test.woniuwnwn.top<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
            proxy_pass xx.xx.xx.xx:xxxx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>反向代理还有很多配置可以看nginx的官网<a href="http://nginx.org/en/docs/http/ngx_http_proxy_module.html" target="_blank" rel="noopener noreferrer">传送门<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h3 id="将-test匹配代理到目标域名的-配置技巧"><a href="#将-test匹配代理到目标域名的-配置技巧" class="header-anchor">#</a> 将/test匹配代理到目标域名的/配置技巧</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name test.woniuwnwn.top<span class="token punctuation">;</span>
    location /test/ <span class="token punctuation">{</span>
            proxy_pass xx.xx.xx.xx:xxxx/<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>由上面这个例子可以看出，技巧就是将<code>/test</code>后面加上<code>/</code>，在<code>proxy_pass</code>的代理域名后面也加一个<code>/</code></li></ul> <h2 id="适配pc或mobile设备，来跳转不同域名"><a href="#适配pc或mobile设备，来跳转不同域名" class="header-anchor">#</a> 适配PC或mobile设备，来跳转不同域名</h2> <h3 id="通过-http-user-agent来做判断"><a href="#通过-http-user-agent来做判断" class="header-anchor">#</a> 通过$http_user_agent来做判断</h3> <div class="language- line-numbers-mode"><pre class="language-text"><code>server {
    listen 80;
    server_name www.woniuwnwn.top;
    location / {
            root /data/pc;
            if ($http_user_agent ~* (mobile|nokia|iphone|ipad|android|samsung|htc|blackberry)) {
              root /data/mobile;
            }
            index index.html index.htm;
    }
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <ul><li>这个自适应是nginx帮我们进行不同平台进行不同页面的加载</li> <li>和前端的的自适应不是一回事，通过nginx可以帮助前端来做适配，就不用把适配的代码都写到一个工程里面了，相当于减小包体积，增加加载速度，减小白屏时间</li></ul></div> <h2 id="负载均衡"><a href="#负载均衡" class="header-anchor">#</a> 负载均衡</h2> <h3 id="upstream"><a href="#upstream" class="header-anchor">#</a> upstream</h3> <ul><li>简单配置一个负载均衡的小案例</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>upstream group1<span class="token punctuation">{</span>
        server xx.xx.xx.xx.端口1<span class="token punctuation">;</span>
        server xx.xx.xx.xx.端口2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name www.woniuwnwn.top<span class="token punctuation">;</span>
    location / <span class="token punctuation">{</span>
            proxy_pass http://group1
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h3 id="weight-负载均衡加权"><a href="#weight-负载均衡加权" class="header-anchor">#</a> weight 负载均衡加权</h3> <h1 id="服务器性能好设置权重大一些，利于资源分配合理化"><a href="#服务器性能好设置权重大一些，利于资源分配合理化" class="header-anchor">#</a> 服务器性能好设置权重大一些，利于资源分配合理化</h1> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>upstream group1<span class="token punctuation">{</span>
        server xx.xx.xx.xx.端口1 weight <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        server xx.xx.xx.xx.端口2 weight <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h2 id="相关"><a href="#相关" class="header-anchor">#</a> 相关</h2> <ul><li><a href="http://openresty.org/cn/" target="_blank" rel="noopener noreferrer">OpenResty<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 基于 NGINX 和 LuaJIT 的 Web 平台。
<div id="comment"></div></li></ul></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">6/9/2020, 1:34:30 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog/other/steam_community.html" class="prev">steam社区访问</a></span> <span class="next"><a href="/blog/other/dockerSummary.html">docker小记</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/blog/assets/js/app.d2fbee4d.js" defer></script><script src="/blog/assets/js/2.f0d7d4dd.js" defer></script><script src="/blog/assets/js/45.d704c988.js" defer></script><script src="/blog/assets/js/5.c71d2297.js" defer></script><script src="/blog/assets/js/3.1faefed4.js" defer></script>
  </body>
</html>
